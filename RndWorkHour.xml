<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper

	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"

	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="RndWorkHourMapper">
    
    <!-- 연구소 임직원 기본 정보 조회 -->
	<select id="SELECT_EMP_INFO" parameterType="java.util.Map" resultType="java.util.Map">
	<![CDATA[
    SELECT IMS.EMP_NAME     /* 성명 */
	      ,IMS.DEPT_CODE    /* 부서코드 */
	      ,DMS.DEPT_NAME    /* 부서명 */
	      ,IMS.JIKJONG_CODE /* 직종코드 */
	      ,IMS.JIKWI_CODE   /* 직위코드 */
	      ,HS_HRM.SMT_GET_CODE_NAME_FUNC('H005',IMS.JIKWI_CODE,#{GV_LANG}) JIKWI_NAME  /* 직위명 */
	      ,IMS.JIKCHAK_CODE /* 직책코드 */
	FROM   HS_HRM.EHR_INSA_MSTR  IMS
	      ,HS_HRM.EHR_DEPT_MSTR  DMS
	WHERE  IMS.OU_CODE        = #{GV_OU_CODE}
	AND    IMS.EMP_NO         = #{GV_EMP_NO}
	AND    IMS.OU_CODE        = DMS.OU_CODE(+)
	AND    IMS.DEPT_CODE      = DMS.DEPT_CODE(+)
	]]>
	</select> 
	
	<!-- 연구소 소속 부서 조회 -->
	<select id="SELECT_RND_DEPT" parameterType="java.util.Map" resultType="java.util.Map">
	<![CDATA[
    SELECT XXX.DEPT_CODE
	      ,XXX.DEPT_NAME
	      ,XXX.UP_DEPT_CODE
	      ,XXX.UP_DEPT_NAME
	      ,XXX.APPLY_ST_DATE
	      ,XXX.APPLY_ED_DATE
	FROM   (SELECT EDV.UP_DEPT_CODE
	              ,SMT_GET_DEPT_NAME_FUNC(EDV.OU_CODE,EDV.UP_DEPT_CODE) UP_DEPT_NAME
	              ,EDV.DEPT_CODE
	              ,EDV.DEPT_NAME
	              ,EDV.APPLY_ST_DATE
	              ,EDV.APPLY_ED_DATE
	        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
	        WHERE  EDV.OU_CODE          = #{OU_CODE}
	        AND    EDV.DEPT_TYPE        = '50'   
	        AND    EDV.DEPT_CODE        IN (SELECT T.DEPT_CODE
	                                        FROM   HS_HRM.EHR_INSA_GAZ_LINE  T
	                                        WHERE  T.OU_CODE          = #{OU_CODE}
	                                        AND    T.EMP_NO           = #{EMP_NO}
	                                        AND   (T.JIKCHAK_CODE     IS NOT NULL AND T.JIKCHAK_CODE  <> '99' )
	                                        AND    T.CONFIRM_FLAG     = 'Y'
	                                        AND    T.APPLY_FLAG       = 'Y'
	                                        AND   (T.CHARGE_END_DATE - T.CHARGE_DATE) > 0
	                                        AND  ((T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	                                        OR    (T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	                                             )   
	                                        )  /* 팀 */
	        AND  ((EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	        OR    (EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	             )
	        UNION ALL
	        SELECT EDV.UP_DEPT_CODE
	              ,SMT_GET_DEPT_NAME_FUNC(EDV.OU_CODE,EDV.UP_DEPT_CODE) UP_DEPT_NAME
	              ,EDV.DEPT_CODE
	              ,EDV.DEPT_NAME
	              ,EDV.APPLY_ST_DATE
	              ,EDV.APPLY_ED_DATE
	        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
	        WHERE  EDV.OU_CODE          = #{OU_CODE}
	        AND    EDV.DEPT_TYPE        = '50'     
	        AND    EDV.UP_DEPT_CODE     IN (SELECT T.DEPT_CODE
	                                        FROM   HS_HRM.EHR_INSA_GAZ_LINE  T
	                                        WHERE  T.OU_CODE          = #{OU_CODE}
	                                        AND    T.EMP_NO           = #{EMP_NO}
	                                        AND   (T.JIKCHAK_CODE     IS NOT NULL AND T.JIKCHAK_CODE  <> '99' )
	                                        AND    T.CONFIRM_FLAG     = 'Y'
	                                        AND    T.APPLY_FLAG       = 'Y'
	                                        AND   (T.CHARGE_END_DATE - T.CHARGE_DATE) > 0
	                                        AND  ((T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	                                        OR    (T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	                                             )   
	                                        )     /* 실 */
	        AND  ((EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	        OR    (EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	             )
	        UNION ALL
	        SELECT EDV.UP_DEPT_CODE
	              ,SMT_GET_DEPT_NAME_FUNC(EDV.OU_CODE,EDV.UP_DEPT_CODE) UP_DEPT_NAME
	              ,EDV.DEPT_CODE
	              ,EDV.DEPT_NAME
	              ,EDV.APPLY_ST_DATE
	              ,EDV.APPLY_ED_DATE
	        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
	        WHERE  EDV.OU_CODE          = #{OU_CODE}
	        AND    EDV.DEPT_TYPE        = '50' 
	        AND    EDV.UP_DEPT_CODE     IN (SELECT EDV.DEPT_CODE
	                                        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
	                                        WHERE  EDV.OU_CODE          = #{OU_CODE}
	                                        AND    EDV.UP_DEPT_CODE     IN (SELECT T.DEPT_CODE
	                                                                        FROM   HS_HRM.EHR_INSA_GAZ_LINE  T
	                                                                        WHERE  T.OU_CODE          = #{OU_CODE}
	                                                                        AND    T.EMP_NO           = #{EMP_NO}
	                                                                        AND   (T.JIKCHAK_CODE     IS NOT NULL AND T.JIKCHAK_CODE  <> '99' )
	                                                                        AND    T.CONFIRM_FLAG     = 'Y'
	                                                                        AND    T.APPLY_FLAG       = 'Y'
	                                                                        AND   (T.CHARGE_END_DATE - T.CHARGE_DATE) > 0
	                                                                        AND  ((T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	                                                                        OR    (T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	                                                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	                                                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE  >=LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	                                                                             )   
	                                                                        )  
	                                        AND    EDV.DEPT_TYPE        = '30' 
	                                        )  /* 본부 */
	        AND  ((EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	        OR    (EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
	             )  
	        )  XXX
	WHERE  1 = 1
	]]>
    <if test="@com.oms.MyBatisUtil@isNotEmpty(DEPT_CODE)">
           <![CDATA[
           AND    XXX.DEPT_CODE         LIKE '%' || #{DEPT_CODE} || '%'
           ]]>
    </if>
    <if test="@com.oms.MyBatisUtil@isNotEmpty(DEPT_NAME)">
           <![CDATA[
           AND    XXX.DEPT_NAME         LIKE '%' || #{DEPT_NAME} || '%'
           ]]>
    </if>
	<![CDATA[
	AND    EXISTS
	          (SELECT 1
	           FROM   RND_WORK_CALENDAR_DETAIL_T RWC
	           WHERE  RWC.OU_CODE                = #{OU_CODE}
	           AND    RWC.CURR_DEPT_CODE         = XXX.DEPT_CODE )             
	ORDER BY XXX.APPLY_ST_DATE
	        ,XXX.APPLY_ED_DATE       
	        ,XXX.DEPT_CODE
	]]>
	</select> 
    
    <!-- 연구소 소속 부서별 사번 조회 -->
	<select id="SELECT_RND_EMP" parameterType="java.util.Map" resultType="java.util.Map">
	<![CDATA[
    SELECT DISTINCT 
           RWC.EMP_NO
          ,EIM.EMP_NAME
	FROM   RND_WORK_CALENDAR_DETAIL_T RWC 
	      ,HS_HRM.EHR_INSA_MSTR          EIM
	WHERE  RWC.OU_CODE                = #{OU_CODE}
	AND    RWC.OU_CODE                = EIM.OU_CODE
	AND    RWC.EMP_NO                 = EIM.EMP_NO
	]]>
	<if test="@com.oms.MyBatisUtil@isNotEmpty(EMP_NO)">
           <![CDATA[
           AND    EIM.EMP_NO          LIKE '%' || #{EMP_NO} || '%'
           ]]>
    </if>
    <if test="@com.oms.MyBatisUtil@isNotEmpty(EMP_NAME)">
           <![CDATA[
           AND    EIM.EMP_NAME        LIKE '%' || #{EMP_NAME} || '%'
           ]]>
    </if>
    <if test="@com.oms.MyBatisUtil@isNotEmpty(DEPT_CODE)">
           <![CDATA[
           AND    RWC.CURR_DEPT_CODE         = #{DEPT_CODE}
           ]]>
    </if>
    <if test="@com.oms.MyBatisUtil@isEmpty(DEPT_CODE)">
           <![CDATA[
           AND    RWC.CURR_DEPT_CODE   IN 
                   (SELECT XXX.DEPT_CODE
					FROM   (SELECT EDV.UP_DEPT_CODE
					              ,SMT_GET_DEPT_NAME_FUNC(EDV.OU_CODE,EDV.UP_DEPT_CODE) UP_DEPT_NAME
					              ,EDV.DEPT_CODE
					              ,EDV.DEPT_NAME
					              ,EDV.APPLY_ST_DATE
					              ,EDV.APPLY_ED_DATE
					        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
					        WHERE  EDV.OU_CODE          = #{OU_CODE}
					        AND    EDV.DEPT_TYPE        = '50'   
					        AND    EDV.DEPT_CODE        IN (SELECT T.DEPT_CODE
					                                        FROM   HS_HRM.EHR_INSA_GAZ_LINE  T
					                                        WHERE  T.OU_CODE          = #{OU_CODE}
					                                        AND    T.EMP_NO           = #{DEPT_EMP_NO}
					                                        AND   (T.JIKCHAK_CODE     IS NOT NULL AND T.JIKCHAK_CODE  <> '99' )
					                                        AND    T.CONFIRM_FLAG     = 'Y'
					                                        AND    T.APPLY_FLAG       = 'Y'
					                                        AND   (T.CHARGE_END_DATE - T.CHARGE_DATE) > 0
					                                        AND  ((T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                             )   
					                                        )  /* 팀 */
					        AND  ((EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					             )
					        UNION ALL
					        SELECT EDV.UP_DEPT_CODE
					              ,SMT_GET_DEPT_NAME_FUNC(EDV.OU_CODE,EDV.UP_DEPT_CODE) UP_DEPT_NAME
					              ,EDV.DEPT_CODE
					              ,EDV.DEPT_NAME
					              ,EDV.APPLY_ST_DATE
					              ,EDV.APPLY_ED_DATE
					        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
					        WHERE  EDV.OU_CODE          = #{OU_CODE}
					        AND    EDV.DEPT_TYPE        = '50'     
					        AND    EDV.UP_DEPT_CODE     IN (SELECT T.DEPT_CODE
					                                        FROM   HS_HRM.EHR_INSA_GAZ_LINE  T
					                                        WHERE  T.OU_CODE          = #{OU_CODE}
					                                        AND    T.EMP_NO           = #{DEPT_EMP_NO}
					                                        AND   (T.JIKCHAK_CODE     IS NOT NULL AND T.JIKCHAK_CODE  <> '99' )
					                                        AND    T.CONFIRM_FLAG     = 'Y'
					                                        AND    T.APPLY_FLAG       = 'Y'
					                                        AND   (T.CHARGE_END_DATE - T.CHARGE_DATE) > 0
					                                        AND  ((T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                             )   
					                                        )     /* 실 */
					        AND  ((EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					             )
					        UNION ALL
					        SELECT EDV.UP_DEPT_CODE
					              ,SMT_GET_DEPT_NAME_FUNC(EDV.OU_CODE,EDV.UP_DEPT_CODE) UP_DEPT_NAME
					              ,EDV.DEPT_CODE
					              ,EDV.DEPT_NAME
					              ,EDV.APPLY_ST_DATE
					              ,EDV.APPLY_ED_DATE
					        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
					        WHERE  EDV.OU_CODE          = #{OU_CODE}
					        AND    EDV.DEPT_TYPE        = '50' 
					        AND    EDV.UP_DEPT_CODE     IN (SELECT EDV.DEPT_CODE
					                                        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
					                                        WHERE  EDV.OU_CODE          = #{OU_CODE}
					                                        AND    EDV.UP_DEPT_CODE     IN (SELECT T.DEPT_CODE
					                                                                        FROM   HS_HRM.EHR_INSA_GAZ_LINE  T
					                                                                        WHERE  T.OU_CODE          = #{OU_CODE}
					                                                                        AND    T.EMP_NO           = #{DEPT_EMP_NO}
					                                                                        AND   (T.JIKCHAK_CODE     IS NOT NULL AND T.JIKCHAK_CODE  <> '99' )
					                                                                        AND    T.CONFIRM_FLAG     = 'Y'
					                                                                        AND    T.APPLY_FLAG       = 'Y'
					                                                                        AND   (T.CHARGE_END_DATE - T.CHARGE_DATE) > 0
					                                                                        AND  ((T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                                                        OR    (T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE  >=LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                                                             )   
					                                                                        )  
					                                        AND    EDV.DEPT_TYPE        = '30' 
					                                        )  /* 본부 */
					        AND  ((EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					             )  
					        )  XXX
					WHERE EXISTS
					          (SELECT 1
					           FROM   RND_WORK_CALENDAR_DETAIL_T RWC
					           WHERE  RWC.OU_CODE                = #{OU_CODE}
					           AND    RWC.CURR_DEPT_CODE         = XXX.DEPT_CODE )               
                  )
           ]]>
    </if>
    <![CDATA[   
    ORDER BY RWC.EMP_NO
	]]>
	</select> 
        
	<!-- 연구소 시간관리 달력 조회 -->
	<select id="SELECT_RND_WORK_CALENDAR" parameterType="java.util.Map" resultType="java.util.Map">
	<![CDATA[
	SELECT RWC.DATA_TYPE                               DATA_TYPE
          ,DECODE(RWC.DATA_TYPE,'2','요일','4','규정시간')  GUBUN
          ,RWC.DD_01 ,RWC.DD_02 ,RWC.DD_03 ,RWC.DD_04 ,RWC.DD_05      
          ,RWC.DD_06 ,RWC.DD_07 ,RWC.DD_08 ,RWC.DD_09 ,RWC.DD_10
          ,RWC.DD_11 ,RWC.DD_12 ,RWC.DD_13 ,RWC.DD_14 ,RWC.DD_15
          ,RWC.DD_16 ,RWC.DD_17 ,RWC.DD_18 ,RWC.DD_19 ,RWC.DD_20
          ,RWC.DD_21 ,RWC.DD_22 ,RWC.DD_23 ,RWC.DD_24 ,RWC.DD_25
          ,RWC.DD_26 ,RWC.DD_27 ,RWC.DD_28 ,RWC.DD_29 ,RWC.DD_30
          ,RWC.DD_31
          ,CASE WHEN RWC.DATA_TYPE = '4' THEN
               TO_CHAR(TO_NUMBER(NVL(RWC.DD_01,'0')) + TO_NUMBER(NVL(RWC.DD_02,'0')) + TO_NUMBER(NVL(RWC.DD_03,'0')) + TO_NUMBER(NVL(RWC.DD_04,'0')) + TO_NUMBER(NVL(RWC.DD_05,'0')) +      
                       TO_NUMBER(NVL(RWC.DD_06,'0')) + TO_NUMBER(NVL(RWC.DD_07,'0')) + TO_NUMBER(NVL(RWC.DD_08,'0')) + TO_NUMBER(NVL(RWC.DD_09,'0')) + TO_NUMBER(NVL(RWC.DD_10,'0')) +
                       TO_NUMBER(NVL(RWC.DD_11,'0')) + TO_NUMBER(NVL(RWC.DD_12,'0')) + TO_NUMBER(NVL(RWC.DD_13,'0')) + TO_NUMBER(NVL(RWC.DD_14,'0')) + TO_NUMBER(NVL(RWC.DD_15,'0')) +
                       TO_NUMBER(NVL(RWC.DD_16,'0')) + TO_NUMBER(NVL(RWC.DD_17,'0')) + TO_NUMBER(NVL(RWC.DD_18,'0')) + TO_NUMBER(NVL(RWC.DD_19,'0')) + TO_NUMBER(NVL(RWC.DD_20,'0')) +
                       TO_NUMBER(NVL(RWC.DD_21,'0')) + TO_NUMBER(NVL(RWC.DD_22,'0')) + TO_NUMBER(NVL(RWC.DD_23,'0')) + TO_NUMBER(NVL(RWC.DD_24,'0')) + TO_NUMBER(NVL(RWC.DD_25,'0')) +
                       TO_NUMBER(NVL(RWC.DD_26,'0')) + TO_NUMBER(NVL(RWC.DD_27,'0')) + TO_NUMBER(NVL(RWC.DD_28,'0')) + TO_NUMBER(NVL(RWC.DD_29,'0')) + TO_NUMBER(NVL(RWC.DD_30,'0')) +
                       TO_NUMBER(NVL(RWC.DD_31,'0')))
             ELSE
               TO_CHAR(NULL)
           END                     ROW_TOTAL
    FROM   RND_WORK_CALENDAR_MGT_T RWC
    WHERE  RWC.OU_CODE             = #{OU_CODE}
    AND    RWC.YYYY_MM             = #{WORK_YYYYMM}
    AND    RWC.DATA_TYPE           IN ('2','4')
    UNION ALL
    SELECT '5'             DATA_TYPE
          ,'입력시간'         GUBUN
          ,TO_CHAR(XXX.DD_01) DD_01 ,TO_CHAR(XXX.DD_02) DD_02 ,TO_CHAR(XXX.DD_03) DD_03 ,TO_CHAR(XXX.DD_04) DD_04 
          ,TO_CHAR(XXX.DD_05) DD_05 ,TO_CHAR(XXX.DD_06) DD_06 ,TO_CHAR(XXX.DD_07) DD_07 ,TO_CHAR(XXX.DD_08) DD_08 
          ,TO_CHAR(XXX.DD_09) DD_09 ,TO_CHAR(XXX.DD_10) DD_10 ,TO_CHAR(XXX.DD_11) DD_11 ,TO_CHAR(XXX.DD_12) DD_12 
          ,TO_CHAR(XXX.DD_13) DD_13 ,TO_CHAR(XXX.DD_14) DD_14 ,TO_CHAR(XXX.DD_15) DD_15 ,TO_CHAR(XXX.DD_16) DD_16 
          ,TO_CHAR(XXX.DD_17) DD_17 ,TO_CHAR(XXX.DD_18) DD_18 ,TO_CHAR(XXX.DD_19) DD_19 ,TO_CHAR(XXX.DD_20) DD_20
          ,TO_CHAR(XXX.DD_21) DD_21 ,TO_CHAR(XXX.DD_22) DD_22 ,TO_CHAR(XXX.DD_23) DD_23 ,TO_CHAR(XXX.DD_24) DD_24 
          ,TO_CHAR(XXX.DD_25) DD_25 ,TO_CHAR(XXX.DD_26) DD_26 ,TO_CHAR(XXX.DD_27) DD_27 ,TO_CHAR(XXX.DD_28) DD_28 
          ,TO_CHAR(XXX.DD_29) DD_29 ,TO_CHAR(XXX.DD_30) DD_30 ,TO_CHAR(XXX.DD_31) DD_31
          ,TO_CHAR(XXX.DD_01 + XXX.DD_02 + XXX.DD_03 + XXX.DD_04 + XXX.DD_05 + XXX.DD_06 + XXX.DD_07 + XXX.DD_08 + XXX.DD_09 + XXX.DD_10 +
                   XXX.DD_11 + XXX.DD_12 + XXX.DD_13 + XXX.DD_14 + XXX.DD_15 + XXX.DD_16 + XXX.DD_17 + XXX.DD_18 + XXX.DD_19 + XXX.DD_20 +
                   XXX.DD_21 + XXX.DD_22 + XXX.DD_23 + XXX.DD_24 + XXX.DD_25 + XXX.DD_26 + XXX.DD_27 + XXX.DD_28 + XXX.DD_29 + XXX.DD_30 +
                   XXX.DD_31)    ROW_TOTAL
    FROM   (SELECT /* '8.1' AS DD_01 */
                   NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'01',RWD.WORK_TIME,0)),0) AS DD_01 
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'02',RWD.WORK_TIME,0)),0) AS DD_02
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'03',RWD.WORK_TIME,0)),0) AS DD_03
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'04',RWD.WORK_TIME,0)),0) AS DD_04
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'05',RWD.WORK_TIME,0)),0) AS DD_05
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'06',RWD.WORK_TIME,0)),0) AS DD_06
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'07',RWD.WORK_TIME,0)),0) AS DD_07
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'08',RWD.WORK_TIME,0)),0) AS DD_08
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'09',RWD.WORK_TIME,0)),0) AS DD_09
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'10',RWD.WORK_TIME,0)),0) AS DD_10
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'11',RWD.WORK_TIME,0)),0) AS DD_11
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'12',RWD.WORK_TIME,0)),0) AS DD_12
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'13',RWD.WORK_TIME,0)),0) AS DD_13
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'14',RWD.WORK_TIME,0)),0) AS DD_14
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'15',RWD.WORK_TIME,0)),0) AS DD_15
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'16',RWD.WORK_TIME,0)),0) AS DD_16
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'17',RWD.WORK_TIME,0)),0) AS DD_17
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'18',RWD.WORK_TIME,0)),0) AS DD_18
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'19',RWD.WORK_TIME,0)),0) AS DD_19
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'20',RWD.WORK_TIME,0)),0) AS DD_20
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'21',RWD.WORK_TIME,0)),0) AS DD_21
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'22',RWD.WORK_TIME,0)),0) AS DD_22
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'23',RWD.WORK_TIME,0)),0) AS DD_23
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'24',RWD.WORK_TIME,0)),0) AS DD_24
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'25',RWD.WORK_TIME,0)),0) AS DD_25
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'26',RWD.WORK_TIME,0)),0) AS DD_26
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'27',RWD.WORK_TIME,0)),0) AS DD_27
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'28',RWD.WORK_TIME,0)),0) AS DD_28
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'29',RWD.WORK_TIME,0)),0) AS DD_29
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'30',RWD.WORK_TIME,0)),0) AS DD_30
                  ,NVL(SUM(DECODE(TO_CHAR(RWD.WORK_DATE,'DD'),'31',RWD.WORK_TIME,0)),0) AS DD_31
            FROM   RND_WORK_CALENDAR_DETAIL_T RWD
            WHERE  RWD.OU_CODE                = #{OU_CODE}
            AND    RWD.WORK_DATE              BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD'))
            AND    EXISTS
                       (SELECT 1
                        FROM   RND_WORK_CALENDAR_MGT_T RWC
					    WHERE  RWC.OU_CODE             = #{OU_CODE}
					    AND    RWC.YYYY_MM             = #{WORK_YYYYMM} )
     ]]>
     <if test="@com.oms.MyBatisUtil@isNotEmpty(DEPT_CODE)">
            <![CDATA[
            AND    RWD.CURR_DEPT_CODE         = #{DEPT_CODE}
        	]]>
     </if>
     <if test="@com.oms.MyBatisUtil@isEmpty(DEPT_CODE) and AUTH_CODE.equals('DEPT')">
            <![CDATA[
            AND    RWD.CURR_DEPT_CODE         IN            
                   (SELECT XXX.DEPT_CODE
					FROM   (SELECT EDV.UP_DEPT_CODE
					              ,SMT_GET_DEPT_NAME_FUNC(EDV.OU_CODE,EDV.UP_DEPT_CODE) UP_DEPT_NAME
					              ,EDV.DEPT_CODE
					              ,EDV.DEPT_NAME
					              ,EDV.APPLY_ST_DATE
					              ,EDV.APPLY_ED_DATE
					        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
					        WHERE  EDV.OU_CODE          = #{OU_CODE}
					        AND    EDV.DEPT_TYPE        = '50'   
					        AND    EDV.DEPT_CODE        IN (SELECT T.DEPT_CODE
					                                        FROM   HS_HRM.EHR_INSA_GAZ_LINE  T
					                                        WHERE  T.OU_CODE          = #{OU_CODE}
					                                        AND    T.EMP_NO           = #{DEPT_EMP_NO}
					                                        AND   (T.JIKCHAK_CODE     IS NOT NULL AND T.JIKCHAK_CODE  <> '99' )
					                                        AND    T.CONFIRM_FLAG     = 'Y'
					                                        AND    T.APPLY_FLAG       = 'Y'
					                                        AND   (T.CHARGE_END_DATE - T.CHARGE_DATE) > 0
					                                        AND  ((T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                             )   
					                                        )  /* 팀 */
					        AND  ((EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					             )
					        UNION ALL
					        SELECT EDV.UP_DEPT_CODE
					              ,SMT_GET_DEPT_NAME_FUNC(EDV.OU_CODE,EDV.UP_DEPT_CODE) UP_DEPT_NAME
					              ,EDV.DEPT_CODE
					              ,EDV.DEPT_NAME
					              ,EDV.APPLY_ST_DATE
					              ,EDV.APPLY_ED_DATE
					        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
					        WHERE  EDV.OU_CODE          = #{OU_CODE}
					        AND    EDV.DEPT_TYPE        = '50'     
					        AND    EDV.UP_DEPT_CODE     IN (SELECT T.DEPT_CODE
					                                        FROM   HS_HRM.EHR_INSA_GAZ_LINE  T
					                                        WHERE  T.OU_CODE          = #{OU_CODE}
					                                        AND    T.EMP_NO           = #{DEPT_EMP_NO}
					                                        AND   (T.JIKCHAK_CODE     IS NOT NULL AND T.JIKCHAK_CODE  <> '99' )
					                                        AND    T.CONFIRM_FLAG     = 'Y'
					                                        AND    T.APPLY_FLAG       = 'Y'
					                                        AND   (T.CHARGE_END_DATE - T.CHARGE_DATE) > 0
					                                        AND  ((T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                             )   
					                                        )     /* 실 */
					        AND  ((EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					             )
					        UNION ALL
					        SELECT EDV.UP_DEPT_CODE
					              ,SMT_GET_DEPT_NAME_FUNC(EDV.OU_CODE,EDV.UP_DEPT_CODE) UP_DEPT_NAME
					              ,EDV.DEPT_CODE
					              ,EDV.DEPT_NAME
					              ,EDV.APPLY_ST_DATE
					              ,EDV.APPLY_ED_DATE
					        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
					        WHERE  EDV.OU_CODE          = #{OU_CODE}
					        AND    EDV.DEPT_TYPE        = '50' 
					        AND    EDV.UP_DEPT_CODE     IN (SELECT EDV.DEPT_CODE
					                                        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
					                                        WHERE  EDV.OU_CODE          = #{OU_CODE}
					                                        AND    EDV.UP_DEPT_CODE     IN (SELECT T.DEPT_CODE
					                                                                        FROM   HS_HRM.EHR_INSA_GAZ_LINE  T
					                                                                        WHERE  T.OU_CODE          = #{OU_CODE}
					                                                                        AND    T.EMP_NO           = #{DEPT_EMP_NO}
					                                                                        AND   (T.JIKCHAK_CODE     IS NOT NULL AND T.JIKCHAK_CODE  <> '99' )
					                                                                        AND    T.CONFIRM_FLAG     = 'Y'
					                                                                        AND    T.APPLY_FLAG       = 'Y'
					                                                                        AND   (T.CHARGE_END_DATE - T.CHARGE_DATE) > 0
					                                                                        AND  ((T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                                                        OR    (T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE  >=LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                                                             )   
					                                                                        )  
					                                        AND    EDV.DEPT_TYPE        = '30' 
					                                        )  /* 본부 */
					        AND  ((EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					             )  
					        )  XXX
					WHERE EXISTS
					          (SELECT 1
					           FROM   RND_WORK_CALENDAR_DETAIL_T RWC
					           WHERE  RWC.OU_CODE                = #{OU_CODE}
					           AND    RWC.CURR_DEPT_CODE         = XXX.DEPT_CODE )               
                  )
        	]]>
     </if>
     <if test="@com.oms.MyBatisUtil@isNotEmpty(EMP_NO)">
            <![CDATA[
        	AND    RWD.EMP_NO                 = #{EMP_NO}
        	]]>
     </if>
            ) XXX
    <![CDATA[   
    ORDER BY DATA_TYPE
	]]>
	</select>
    
    <!-- 연구소 시간관리 달력 조회 : 요일 정보 -->
	<select id="SELECT_RND_WC_DATE" parameterType="java.util.Map" resultType="java.util.Map">
	<![CDATA[
	SELECT RWC.DD_01 ,RWC.DD_02 ,RWC.DD_03 ,RWC.DD_04 ,RWC.DD_05      
	      ,RWC.DD_06 ,RWC.DD_07 ,RWC.DD_08 ,RWC.DD_09 ,RWC.DD_10
          ,RWC.DD_11 ,RWC.DD_12 ,RWC.DD_13 ,RWC.DD_14 ,RWC.DD_15
          ,RWC.DD_16 ,RWC.DD_17 ,RWC.DD_18 ,RWC.DD_19 ,RWC.DD_20
          ,RWC.DD_21 ,RWC.DD_22 ,RWC.DD_23 ,RWC.DD_24 ,RWC.DD_25
          ,RWC.DD_26 ,RWC.DD_27 ,RWC.DD_28 ,RWC.DD_29 ,RWC.DD_30
          ,RWC.DD_31
    FROM   RND_WORK_CALENDAR_MGT_T RWC
    WHERE  RWC.OU_CODE             = #{OU_CODE}
    AND    RWC.YYYY_MM             = #{WORK_YYYYMM}
    AND    RWC.DATA_TYPE           = '1'
    ORDER BY RWC.DATA_TYPE
	]]>
	</select>
    
    <!-- 연구소 시간관리 달력 조회 : 휴일 정보 -->
	<select id="SELECT_RND_WC_HOLIDAY" parameterType="java.util.Map" resultType="java.util.Map">
	<![CDATA[
	SELECT RWC.DD_01 ,RWC.DD_02 ,RWC.DD_03 ,RWC.DD_04 ,RWC.DD_05      
	      ,RWC.DD_06 ,RWC.DD_07 ,RWC.DD_08 ,RWC.DD_09 ,RWC.DD_10
          ,RWC.DD_11 ,RWC.DD_12 ,RWC.DD_13 ,RWC.DD_14 ,RWC.DD_15
          ,RWC.DD_16 ,RWC.DD_17 ,RWC.DD_18 ,RWC.DD_19 ,RWC.DD_20
          ,RWC.DD_21 ,RWC.DD_22 ,RWC.DD_23 ,RWC.DD_24 ,RWC.DD_25
          ,RWC.DD_26 ,RWC.DD_27 ,RWC.DD_28 ,RWC.DD_29 ,RWC.DD_30
          ,RWC.DD_31
    FROM   RND_WORK_CALENDAR_MGT_T RWC
    WHERE  RWC.OU_CODE             = #{OU_CODE}
    AND    RWC.YYYY_MM             = #{WORK_YYYYMM}
    AND    RWC.DATA_TYPE           = '3'
    ORDER BY RWC.DATA_TYPE
	]]>
	</select>
    
    <!-- 연구소 시간관리 상세내역 그리드 조회 -->
	<select id="SELECT_RND_WORK_DETAIL" parameterType="java.util.Map" resultType="java.util.Map">
	<![CDATA[
	SELECT RCD.WORK_ID
	      ,RCD.OU_CODE
          ,RCD.CURR_DEPT_CODE  AS DEPT_CODE
	      ,EDM.DEPT_NAME
	      ,RCD.EMP_NO
	      ,EIM.EMP_NAME
	      ,TO_CHAR(RCD.WORK_DATE,'YYYYMMDD')                     WORK_DATE
	      ,HS_HRM.SMT_GET_CODE_NAME_FUNC('H005',RCD.JIKWI_CODE,#{GV_LANG})    JIKWI_NAME  
	      ,SMT_GET_CODE_NAME_FUNC('R001',RCD.WORK_TYPE,#{GV_LANG})         WORK_TYPE
	      ,RCD.PJT_CODE
	      ,RCD.PJT_NAME
	      ,SMT_GET_CODE_NAME_FUNC('R002',RCD.DEV_PHASE,#{GV_LANG})     DEV_PHASE
	      ,SMT_GET_CODE_NAME_FUNC('R003',RCD.WORK_NAME,#{GV_LANG})     WORK_NAME
	      ,RCD.WORK_TEXT
	      ,RCD.WORK_TIME
          ,RCD.JIKJONG_CODE
          ,RCD.JIKWI_CODE
	FROM   RND_WORK_CALENDAR_DETAIL_T RCD
	      ,HS_HRM.EHR_INSA_MSTR       EIM
	      ,HS_HRM.EHR_DEPT_MSTR       EDM
	WHERE  RCD.OU_CODE                = #{OU_CODE}
	AND    RCD.WORK_DATE              = TO_DATE(#{WORK_YYYYMMDD},'YYYYMMDD')
    ]]>
     <if test="@com.oms.MyBatisUtil@isNotEmpty(DEPT_CODE)">
            <![CDATA[
            AND    RCD.CURR_DEPT_CODE         = #{DEPT_CODE}
        	]]>
     </if>
     
     <if test="@com.oms.MyBatisUtil@isEmpty(DEPT_CODE) and AUTH_CODE.equals('DEPT')">
            <![CDATA[
            AND    RCD.CURR_DEPT_CODE         IN            
                   (SELECT XXX.DEPT_CODE
					FROM   (SELECT EDV.UP_DEPT_CODE
					              ,SMT_GET_DEPT_NAME_FUNC(EDV.OU_CODE,EDV.UP_DEPT_CODE) UP_DEPT_NAME
					              ,EDV.DEPT_CODE
					              ,EDV.DEPT_NAME
					              ,EDV.APPLY_ST_DATE
					              ,EDV.APPLY_ED_DATE
					        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
					        WHERE  EDV.OU_CODE          = #{OU_CODE}
					        AND    EDV.DEPT_TYPE        = '50'   
					        AND    EDV.DEPT_CODE        IN (SELECT T.DEPT_CODE
					                                        FROM   HS_HRM.EHR_INSA_GAZ_LINE  T
					                                        WHERE  T.OU_CODE          = #{OU_CODE}
					                                        AND    T.EMP_NO           = #{DEPT_EMP_NO}
					                                        AND   (T.JIKCHAK_CODE     IS NOT NULL AND T.JIKCHAK_CODE  <> '99' )
					                                        AND    T.CONFIRM_FLAG     = 'Y'
					                                        AND    T.APPLY_FLAG       = 'Y'
					                                        AND   (T.CHARGE_END_DATE - T.CHARGE_DATE) > 0
					                                        AND  ((T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                             )   
					                                        )  /* 팀 */
					        AND  ((EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					             )
					        UNION ALL
					        SELECT EDV.UP_DEPT_CODE
					              ,SMT_GET_DEPT_NAME_FUNC(EDV.OU_CODE,EDV.UP_DEPT_CODE) UP_DEPT_NAME
					              ,EDV.DEPT_CODE
					              ,EDV.DEPT_NAME
					              ,EDV.APPLY_ST_DATE
					              ,EDV.APPLY_ED_DATE
					        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
					        WHERE  EDV.OU_CODE          = #{OU_CODE}
					        AND    EDV.DEPT_TYPE        = '50'     
					        AND    EDV.UP_DEPT_CODE     IN (SELECT T.DEPT_CODE
					                                        FROM   HS_HRM.EHR_INSA_GAZ_LINE  T
					                                        WHERE  T.OU_CODE          = #{OU_CODE}
					                                        AND    T.EMP_NO           = #{DEPT_EMP_NO}
					                                        AND   (T.JIKCHAK_CODE     IS NOT NULL AND T.JIKCHAK_CODE  <> '99' )
					                                        AND    T.CONFIRM_FLAG     = 'Y'
					                                        AND    T.APPLY_FLAG       = 'Y'
					                                        AND   (T.CHARGE_END_DATE - T.CHARGE_DATE) > 0
					                                        AND  ((T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                             )   
					                                        )     /* 실 */
					        AND  ((EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					             )
					        UNION ALL
					        SELECT EDV.UP_DEPT_CODE
					              ,SMT_GET_DEPT_NAME_FUNC(EDV.OU_CODE,EDV.UP_DEPT_CODE) UP_DEPT_NAME
					              ,EDV.DEPT_CODE
					              ,EDV.DEPT_NAME
					              ,EDV.APPLY_ST_DATE
					              ,EDV.APPLY_ED_DATE
					        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
					        WHERE  EDV.OU_CODE          = #{OU_CODE}
					        AND    EDV.DEPT_TYPE        = '50' 
					        AND    EDV.UP_DEPT_CODE     IN (SELECT EDV.DEPT_CODE
					                                        FROM   HS_HRM.EHR_DEPT_MSTR_HIST_V EDV
					                                        WHERE  EDV.OU_CODE          = #{OU_CODE}
					                                        AND    EDV.UP_DEPT_CODE     IN (SELECT T.DEPT_CODE
					                                                                        FROM   HS_HRM.EHR_INSA_GAZ_LINE  T
					                                                                        WHERE  T.OU_CODE          = #{OU_CODE}
					                                                                        AND    T.EMP_NO           = #{DEPT_EMP_NO}
					                                                                        AND   (T.JIKCHAK_CODE     IS NOT NULL AND T.JIKCHAK_CODE  <> '99' )
					                                                                        AND    T.CONFIRM_FLAG     = 'Y'
					                                                                        AND    T.APPLY_FLAG       = 'Y'
					                                                                        AND   (T.CHARGE_END_DATE - T.CHARGE_DATE) > 0
					                                                                        AND  ((T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                                                        OR    (T.CHARGE_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                                                        OR    (T.CHARGE_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND T.CHARGE_END_DATE  >=LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					                                                                             )   
					                                                                        )  
					                                        AND    EDV.DEPT_TYPE        = '30' 
					                                        )  /* 본부 */
					        AND  ((EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      <= TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					        OR    (EDV.APPLY_ST_DATE      BETWEEN TO_DATE(#{WORK_YYYYMM}||'01','YYYYMMDD') AND LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')) AND EDV.APPLY_ED_DATE  >= LAST_DAY(TO_DATE(#{WORK_YYYYMM},'YYYYMM')))
					             )  
					        )  XXX
					WHERE EXISTS
					          (SELECT 1
					           FROM   RND_WORK_CALENDAR_DETAIL_T RWC
					           WHERE  RWC.OU_CODE                = #{OU_CODE}
					           AND    RWC.CURR_DEPT_CODE         = XXX.DEPT_CODE )               
                  )
        	]]>
     </if>
     <if test="@com.oms.MyBatisUtil@isNotEmpty(EMP_NO)">
            <![CDATA[
        	AND    RCD.EMP_NO                 = #{EMP_NO}
        	]]>
     </if>
    <![CDATA[   
	AND    RCD.EMP_NO                 = EIM.EMP_NO(+)
	AND    RCD.OU_CODE                = EDM.OU_CODE(+)
	AND    RCD.CURR_DEPT_CODE         = EDM.DEPT_CODE(+)
    ORDER BY EIM.EMP_NAME, RCD.WORK_ID
	]]>
	</select>
    
    <!-- 복사등록 시 봄보박스 값의 사용가능 여부 체크 정보  가져오기  -->
    <select id="GET_COPY_COMBO_ENABLE_INFO" statementType="CALLABLE" parameterType="java.util.Map" resultType="java.util.Map">
    <![CDATA[
        CALL RND_WORK_CALENDAR_MGT_PKG.GET_COPY_COMBO_ENABLE_FLAG(
             #{O_WORKTYPE_FLAG, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{O_DEVPHASE_FLAG, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{O_WORKNAME_FLAG, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{O_ERROR_MSG, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{I_WORK_ID}
            ,#{I_ACTIVE_DATE}
        )
        ]]>
    </select>
    
    <!-- 근무일 변경 시 봄보박스 값의 사용가능 여부 체크 정보  가져오기  -->
    <select id="GET_COMBO_ENABLE_INFO" statementType="CALLABLE" parameterType="java.util.Map" resultType="java.util.Map">
    <![CDATA[
        CALL RND_WORK_CALENDAR_MGT_PKG.GET_COMBO_ENABLE_FLAG(
             #{O_WORKTYPE_FLAG, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{O_DEVPHASE_FLAG, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{O_WORKNAME_FLAG, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{O_ERROR_MSG, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{I_OU_CODE}
            ,#{I_WORKTYPE_CODE}
            ,#{I_DEVPHASE_CODE}
            ,#{I_WORKNAME_CODE}
            ,#{I_WORK_DATE}
        )
        ]]>
    </select>
    
    <!-- 연구소 시간관리 상세내역 화면 조회 -->
	<select id="SELECT_RND_WORK_POPUP" parameterType="java.util.Map" resultType="java.util.Map">
	<![CDATA[
    SELECT RCD.WORK_ID
	      ,RCD.OU_CODE
	      ,RCD.CURR_DEPT_CODE  AS DEPT_CODE
	      ,EDM.DEPT_NAME
	      ,RCD.EMP_NO
	      ,EIM.EMP_NAME
	      ,TO_CHAR(RCD.WORK_DATE,'YYYYMMDD')                     WORK_DATE
	      ,RCD.JIKWI_CODE                                        JIKWI_CODE
	      ,HS_HRM.SMT_GET_CODE_NAME_FUNC('H005',RCD.JIKWI_CODE,#{GV_LANG})    JIKWI_DESC
	      ,RCD.WORK_TYPE                                               WORK_TYPE
	      ,SMT_GET_CODE_NAME_FUNC('R001',RCD.WORK_TYPE,#{GV_LANG})     WORK_TYPE_DESC
	      ,RCD.PJT_CODE
	      ,RCD.PJT_NAME
	      ,RCD.DEV_PHASE                                               DEV_PHASE
	      ,SMT_GET_CODE_NAME_FUNC('R002',RCD.DEV_PHASE,#{GV_LANG})     DEV_PHASE_DESC
	      ,RCD.WORK_NAME                                               WORK_NAME
	      ,SMT_GET_CODE_NAME_FUNC('R003',RCD.WORK_NAME,#{GV_LANG})     WORK_NAME_DESC
	      ,RCD.WORK_TEXT
	      ,RCD.WORK_TIME
	FROM   RND_WORK_CALENDAR_DETAIL_T RCD
	      ,HS_HRM.EHR_INSA_MSTR       EIM
	      ,HS_HRM.EHR_DEPT_MSTR       EDM
	WHERE  RCD.WORK_ID                = #{WORK_ID}
	AND    RCD.OU_CODE                = #{OU_CODE}
	AND    RCD.EMP_NO                 = EIM.EMP_NO(+)
	AND    RCD.OU_CODE                = EDM.OU_CODE(+)
	AND    RCD.CURR_DEPT_CODE         = EDM.DEPT_CODE(+)
    ]]>
    </select>
    
    <!-- 업무성격 입력 콤보박스  -->
    <select id="SELECT_COMBO_WORK_TYPE" parameterType="java.util.Map" resultType="java.util.Map">    
    <![CDATA[       
		SELECT SCC.ITEM_NAME             NAME
		      ,RCH.MAIN_CODE             CODE
		      ,MIN(RCH.MAIN_SORT_NO)     ORDER_BY
		FROM   RND_WORK_CODE_HIERARCHY_T RCH
		      ,SMT_COMM_CODE             SCC
		WHERE  RCH.OU_CODE               = #{OU_CODE} 
		AND    RCH.START_DATE            <= TO_DATE(#{WORK_DATE},'YYYYMMDD')  
		AND    NVL(RCH.END_DATE,SYSDATE+365) >= TO_DATE(#{WORK_DATE},'YYYYMMDD')  
		AND    SCC.GRP_CODE              = #{GROUP_CODE}
		AND    SCC.ACTIVE_FLAG           = 'Y'
		AND    RCH.MAIN_CODE             = SCC.ITEM_CODE
		GROUP BY RCH.MAIN_CODE   
		        ,SCC.ITEM_NAME   
		ORDER BY ORDER_BY,CODE
   	]]>
    </select>    
    
    <!-- 업무단계 입력 콤보박스 : 엄부명 값에 따라 변경  -->
    <select id="SELECT_COMBO_DEV_PHASE" parameterType="java.util.Map" resultType="java.util.Map">    
    <![CDATA[       
		SELECT SCC.ITEM_NAME             NAME
		      ,RCH.MIDDLE_CODE           CODE
		      ,MIN(RCH.MIDDLE_SORT_NO)   ORDER_BY
		FROM   RND_WORK_CODE_HIERARCHY_T RCH
		      ,SMT_COMM_CODE             SCC
		WHERE  RCH.OU_CODE               = #{OU_CODE} 
		AND    RCH.MAIN_CODE             = #{MAIN_CODE} 
		AND    RCH.START_DATE            <= TO_DATE(#{WORK_DATE},'YYYYMMDD')  
		AND    NVL(RCH.END_DATE,SYSDATE+365) >= TO_DATE(#{WORK_DATE},'YYYYMMDD')  
		AND    SCC.GRP_CODE              = #{GROUP_CODE}
		AND    SCC.ACTIVE_FLAG           = 'Y'
		AND    RCH.MIDDLE_CODE           = SCC.ITEM_CODE
		GROUP BY RCH.MIDDLE_CODE   
		        ,SCC.ITEM_NAME   
		ORDER BY ORDER_BY,CODE 
   	]]>
    </select>    
    
    <!-- 업무명 입력 콤보박스 : 엄부명 - 개발단계 값에 따라 변경  -->
    <select id="SELECT_COMBO_WORK_NAME" parameterType="java.util.Map" resultType="java.util.Map">    
    <![CDATA[       
		SELECT SCC.ITEM_NAME             NAME
		      ,RCH.SMALL_CODE            CODE
		      ,MIN(RCH.SMALL_SORT_NO)    ORDER_BY
		FROM   RND_WORK_CODE_HIERARCHY_T RCH
		      ,SMT_COMM_CODE             SCC
		WHERE  RCH.OU_CODE               = #{OU_CODE}    
		AND    RCH.MAIN_CODE             = #{MAIN_CODE} 
		AND    RCH.MIDDLE_CODE           = #{MIDDLE_CODE}              
		AND    RCH.START_DATE            <= TO_DATE(#{WORK_DATE},'YYYYMMDD')    
		AND    NVL(RCH.END_DATE,SYSDATE+365) >= TO_DATE(#{WORK_DATE},'YYYYMMDD')   
		AND    SCC.GRP_CODE              = #{GROUP_CODE}
		AND    SCC.ACTIVE_FLAG           = 'Y'
		AND    RCH.SMALL_CODE            = SCC.ITEM_CODE
		GROUP BY RCH.SMALL_CODE   
		        ,SCC.ITEM_NAME   
		ORDER BY ORDER_BY,CODE
   	]]>
    </select>
    
    <!-- 근무일 정보 가져오기  -->
    <select id="GET_RND_WORKDATE_INFO" statementType="CALLABLE" parameterType="java.util.Map" resultType="java.util.Map">
    <![CDATA[
        CALL RND_WORK_CALENDAR_MGT_PKG.GET_DATE_INFO(
             #{O_DATE_INFO, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{O_ERROR_MSG, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{I_OU_CODE}
            ,#{I_WORK_DATE}
        )
        ]]>
    </select>
    
    <!-- 연구소 시간관리 상세내역 INSERT -->
    <insert id="INSERT_RND_WORK" parameterType="java.util.Map" useGeneratedKeys="false">
    <![CDATA[
   	    INSERT INTO RND_WORK_CALENDAR_DETAIL_T 
		   (WORK_ID
		   ,OU_CODE
		   ,EMP_NO
		   ,WORK_DATE
		   ,PREV_DEPT_CODE
		   ,CURR_DEPT_CODE
		   ,JIKJONG_CODE
		   ,JIKWI_CODE
		   ,WORK_TYPE
		   ,PJT_CODE
		   ,PJT_NAME
		   ,DEV_PHASE
		   ,WORK_NAME
		   ,WORK_TEXT
		   ,WORK_TIME
		   ,INS_USER_ID
		   ,INS_DATE
		   ,UPD_USER_ID
		   ,UPD_DATE 
		   )
		VALUES   
		   (#{WORK_ID}
		   ,#{OU_CODE}
		   ,#{EMP_NO}
		   ,TO_DATE(#{WORK_DATE},'RRRRMMDD')
		   ,#{DEPT_CODE}
		   ,#{DEPT_CODE}
		   ,#{JIKJONG_CODE}
		   ,#{JIKWI_CODE}
		   ,#{WORK_TYPE}        
		   ,#{PJT_CODE}
		   ,#{PJT_NAME}
		   ,#{DEV_PHASE}
		   ,#{WORK_NAME}
		   ,#{WORK_TEXT}
		   ,#{WORK_TIME}
		   ,#{USER_ID}
		   ,SYSDATE
		   ,#{USER_ID}
		   ,SYSDATE
		   ) 
    ]]>    
    </insert>    
    
    <!-- 연구소 시간관리 상세내역 UPDATE -->
    <update id="UPDATE_RND_WORK" parameterType="java.util.Map">    
    <![CDATA[
   	    UPDATE RND_WORK_CALENDAR_DETAIL_T RWC
		SET    RWC.WORK_DATE              = TO_DATE(#{WORK_DATE},'RRRRMMDD')  
		      ,RWC.WORK_TYPE              = #{WORK_TYPE}  
		      ,RWC.PJT_CODE               = #{PJT_CODE}   
		      ,RWC.PJT_NAME               = #{PJT_NAME}   
		      ,RWC.DEV_PHASE              = #{DEV_PHASE}  
		      ,RWC.WORK_NAME              = #{WORK_NAME}  
		      ,RWC.WORK_TEXT              = #{WORK_TEXT}  
		      ,RWC.WORK_TIME              = #{WORK_TIME}  
		      ,RWC.UPD_USER_ID            = #{USER_ID}
		      ,RWC.UPD_DATE               = SYSDATE
		WHERE  RWC.WORK_ID                = #{WORK_ID}
    ]]>    
    </update>     
    
    <!-- 연구소 시간관리 상세내역 DELETE -->
    <delete id="DELETE_RND_WORK" parameterType="java.util.Map">    
        DELETE RND_WORK_CALENDAR_DETAIL_T RWC
        WHERE  RWC.WORK_ID                = #{WORK_ID}
    </delete>    
     
    <!-- 연구소 시간관리 상세 id  : RND_WORK_CALENDAR_DETAIL_S -->  
    <select id="SELECT_RND_WORK_SEQ" parameterType="java.util.Map" resultType="java.util.Map">    
   		<![CDATA[       
        	SELECT RND_WORK_CALENDAR_DETAIL_S.NEXTVAL SEQ_ID FROM DUAL
   		]]>
   	</select> 
   	
   	<!-- 프로젝트 Popup -->
	<select id="SELECT_PROJECT_POPUP" parameterType="java.util.Map" resultType="java.util.Map">
	<![CDATA[
	SELECT PJT.PROJECT_CODE
	      ,PJT.CAR_TYPE_CODE
	      ,PJT.CAR_TYPE_NAME
	      ,PJT.REGISTER_YEAR
	      ,PJT.CUSTOMER_NAME
	      ,PJT.CUSTOMER_NATION_NAME
	      ,SUBSTR(PJT.SOP,1,4) || '-' || SUBSTR(PJT.SOP,5,2)  SOP
	      ,'차종:' || PJT.CAR_TYPE_NAME || ' / 등록년도:' || PJT.REGISTER_YEAR || ' / 고객:' || PJT.CUSTOMER_NAME || '(' || PJT.CUSTOMER_NATION_NAME || ') / SOP:' || SUBSTR(PJT.SOP,1,4) || '년' || SUBSTR(PJT.SOP,5,2) || '월'  PROJECT_NAME
	FROM   OMS_PROJECT_V PJT
	WHERE  PJT.OU_CODE          = #{OU_CODE}
	AND    PJT.LATEST_YN        = 'Y'
	AND    PJT.ROLLING_YN       = 'N'
     ]]>
     <if test="@com.oms.MyBatisUtil@isNotEmpty(PROJECT_CODE)">
            <![CDATA[
            AND    PJT.PROJECT_CODE     LIKE '%' || #{PROJECT_CODE} || '%'
        	]]>
     </if>
     <if test="@com.oms.MyBatisUtil@isNotEmpty(CAR_TYPE_CODE)">
            <![CDATA[
        	AND    PJT.CAR_TYPE_CODE    = #{CAR_TYPE_CODE}
        	]]>
     </if>
    <![CDATA[   
    ORDER BY PJT.PROJECT_CODE
	]]>
	</select>
    
    <!-- 연구소 정부과제 관리 SELECT -->
	<select id="SELECT_GOV_TASK" parameterType="java.util.Map" resultType="java.util.Map">
	<![CDATA[
	SELECT RGT.OU_CODE
	      ,RGT.TASK_CODE
	      ,RGT.TASK_NAME
	      ,RGT.TASK_CODE          PREV_TASK_CODE      
          ,NVL((SELECT 'Y'
                FROM   RND_WORK_CALENDAR_DETAIL_T RCD
                WHERE  RCD.OU_CODE                = RGT.OU_CODE
                AND    RCD.PJT_CODE               = RGT.TASK_CODE 
                AND    ROWNUM                     = 1 ),'N')  USED_YN
	FROM   RND_GOVERNMENT_TASKS_T RGT
	WHERE  RGT.OU_CODE            = #{OU_CODE}
    ]]>
     <if test="@com.oms.MyBatisUtil@isNotEmpty(TASK_CODE)">
            <![CDATA[
            AND    RGT.TASK_CODE     LIKE '%' || #{TASK_CODE} || '%'
        	]]>
     </if>
     <if test="@com.oms.MyBatisUtil@isNotEmpty(TASK_NAME)">
            <![CDATA[
        	AND    RGT.TASK_NAME     LIKE '%' || #{TASK_NAME} || '%'
        	]]>
     </if>
    <![CDATA[   
    ORDER BY RGT.TASK_CODE
	]]>
	</select>
    
    <!-- 연구소 정부과제 관리 INSERT -->
    <insert id="INSERT_GOV_TASK" parameterType="java.util.Map" useGeneratedKeys="false">
    <![CDATA[
   	    INSERT INTO RND_GOVERNMENT_TASKS_T 
		   (OU_CODE
		   ,TASK_CODE
		   ,TASK_NAME
		   ,INS_USER_ID
		   ,INS_DATE
		   ,UPD_USER_ID
		   ,UPD_DATE 
		   )
		VALUES   
		   (#{OU_CODE}
		   ,#{TASK_CODE}
		   ,#{TASK_NAME}
		   ,#{GV_USER_ID}
		   ,SYSDATE
		   ,#{GV_USER_ID}
		   ,SYSDATE
		   ) 
    ]]>    
    </insert>    
    
    <!-- 연구소 정부과제 관리 UPDATE -->
    <update id="UPDATE_GOV_TASK" parameterType="java.util.Map">    
    <![CDATA[
   	    UPDATE RND_GOVERNMENT_TASKS_T RGT
		SET    RGT.OU_CODE            = #{OU_CODE}  
		      ,RGT.TASK_CODE          = #{TASK_CODE}
		      ,RGT.TASK_NAME          = #{TASK_NAME} 
		      ,RGT.UPD_USER_ID        = #{GV_USER_ID}
		      ,RGT.UPD_DATE           = SYSDATE
		WHERE  RGT.OU_CODE            = #{OU_CODE}
		AND    RGT.TASK_CODE          = #{PREV_TASK_CODE}
    ]]>    
    </update>     
    
    <!-- 연구소 정부과제 관리 DELETE -->
    <delete id="DELETE_GOV_TASK" parameterType="java.util.Map">    
        DELETE RND_GOVERNMENT_TASKS_T RGT
        WHERE  RGT.OU_CODE            = #{OU_CODE}
        AND    RGT.TASK_CODE          = #{PREV_TASK_CODE}
    </delete>  
    
    <!-- 연구소 정부과제 관리 중복 체크  -->
    <select id="SELECT_RND_GOV_TASK_DUP_CHK" statementType="CALLABLE" parameterType="java.util.Map" resultType="java.util.Map">
    <![CDATA[
        CALL RND_WORK_CALENDAR_MGT_PKG.CHECK_GOV_TASK_DUP(
             #{O_CNT, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{O_ERROR_MSG, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{I_OU_CODE}
            ,#{I_TASK_CODE}
        )
        ]]>
    </select>
    
    <!-- 연구소 부서,사번 사용여부  체크  -->
    <select id="SELECT_RND_DEPT_ENABLE_CHK" statementType="CALLABLE" parameterType="java.util.Map" resultType="java.util.Map">
    <![CDATA[
        CALL RND_WORK_CALENDAR_MGT_PKG.CHECK_DEPT_EMP_ENABLE(
             #{O_DEPT_FLAG, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{O_EMP_FLAG, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{O_ERROR_MSG, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{I_OU_CODE}
            ,#{I_DEPT_CODE}
            ,#{I_EMP_NO}
            ,#{I_WORK_DATE}
        )
        ]]>
    </select>
    
    <!-- 근무자 발령 정보 가져오기  -->
    <select id="GET_RND_EMP_INFO" statementType="CALLABLE" parameterType="java.util.Map" resultType="java.util.Map">
    <![CDATA[
        CALL RND_WORK_CALENDAR_MGT_PKG.GET_EMP_INFO(
             #{O_DEPT_CODE, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{O_DEPT_NAME, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{O_JIKJONG_CODE, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{O_JIKWI_CODE, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{O_JIKWI_NAME, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{O_ERROR_MSG, mode=OUT, jdbcType=VARCHAR, javaType=String}
            ,#{I_OU_CODE}
            ,#{I_EMP_NO}
            ,#{I_WORK_DATE}
        )
        ]]>
    </select> 
    
    <!-- 프로젝트 차종 콤보  -->
	<select id="SELECT_PROJECT_COMMON_CODE" parameterType="java.util.Map" resultType="java.util.Map">
	<![CDATA[
	SELECT SCC.ITEM_CODE   CODE
	      ,SCC.ITEM_NAME   NAME
	FROM   SMT_COMM_CODE   SCC
	WHERE  SCC.GRP_CODE    = #{GROUP_CODE}
	]]>
	<if test="@com.oms.MyBatisUtil@isNotEmpty(ACTIVE_FLAG)">
	    <![CDATA[
	    AND    SCC.ACTIVE_FLAG =  #{ACTIVE_FLAG}
	    ]]>
	</if>
	<![CDATA[
	ORDER BY SCC.ARR_NO
	]]>
	</select>    
</mapper>

